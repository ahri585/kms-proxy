<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>íšŒì›ê°€ì… - Lockument</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Cache-Control" content="no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <style>
    :root{
      --bg:#f8fafc; --card:#ffffff; --border:#e2e8f0;
      --text:#0f172a; --muted:#64748b; --accent:#3b82f6; --accent-2:#2563eb;
      --success:#10b981; --danger:#ef4444; --warning:#f59e0b;
      --radius:16px; --shadow:0 4px 20px rgba(0,0,0,.08);
      --gradient:linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      color:var(--text);
      background:var(--bg);
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Pretendard,"Apple SD Gothic Neo","Malgun Gothic",sans-serif;
    }
    
    /* ë„¤ë¹„ê²Œì´ì…˜ */
    nav{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:16px 24px;
      background:#ffffff;
      border-bottom:1px solid var(--border);
      box-shadow:0 1px 3px rgba(0,0,0,.05);
      position:sticky;
      top:0;
      z-index:100;
    }
    nav .left{
      font-weight:800;
      font-size:22px;
      letter-spacing:-.3px;
      background:var(--gradient);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }
    nav .right{
      display:flex;
      align-items:center;
      gap:16px;
      font-size:14px;
    }
    nav .right a{
      color:var(--text);
      background:none;
      border:none;
      cursor:pointer;
      font-weight:600;
      text-decoration:none;
      transition:.2s;
      padding:8px 12px;
      border-radius:8px;
    }
    nav .right a:hover{
      background:#f1f5f9;
    }
    
    /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
    .wrap{
      max-width:480px;
      margin:60px auto;
      padding:0 24px;
    }
    
    /* ì¹´ë“œ */
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:40px;
    }
    
    .headline{
      font-size:32px;
      font-weight:800;
      margin:0 0 10px;
      background:var(--gradient);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }
    
    .sub{
      color:var(--muted);
      margin:0 0 32px;
      font-size:16px;
    }
    
    /* í¼ ìš”ì†Œ */
    label{
      display:block;
      font-size:14px;
      font-weight:700;
      color:var(--text);
      margin:20px 0 8px;
    }
    
    input[type="text"],
    input[type="email"],
    input[type="password"]{
      width:100%;
      border:2px solid var(--border);
      color:var(--text);
      background:#fff;
      border-radius:10px;
      padding:12px 16px;
      outline:none;
      font-size:15px;
      transition:.2s;
    }
    
    input[type="text"]:focus,
    input[type="email"]:focus,
    input[type="password"]:focus{
      border-color:var(--accent);
      box-shadow:0 0 0 3px rgba(59,130,246,.1);
    }
    
    /* ë²„íŠ¼ */
    .btn{
      width:100%;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      background:var(--gradient);
      color:#fff;
      border:none;
      border-radius:10px;
      padding:14px 20px;
      cursor:pointer;
      font-weight:700;
      font-size:15px;
      transition:.2s;
      box-shadow:0 2px 8px rgba(102,126,234,.3);
      margin-top:24px;
    }
    
    .btn:hover:not(:disabled){
      transform:translateY(-2px);
      box-shadow:0 4px 16px rgba(102,126,234,.4);
    }
    
    .btn:active:not(:disabled){
      transform:translateY(0);
    }
    
    .btn:disabled{
      opacity:.6;
      cursor:not-allowed;
    }
    
    /* ê²°ê³¼ ë©”ì‹œì§€ */
    #register-result{
      margin-top:16px;
      padding:12px 16px;
      border-radius:8px;
      font-weight:600;
      font-size:14px;
      display:none;
    }
    
    #register-result.success{
      display:block;
      color:#065f46;
      background:#d1fae5;
      border:1px solid #a7f3d0;
    }
    
    #register-result.error{
      display:block;
      color:var(--danger);
      background:#fee2e2;
      border:1px solid #fecaca;
    }
    
    /* ë©”íƒ€ ë§í¬ */
    .meta{
      margin-top:24px;
      text-align:center;
      font-size:14px;
      color:var(--muted);
    }
    
    .meta a{
      color:var(--accent);
      text-decoration:none;
      font-weight:700;
      transition:.2s;
    }
    
    .meta a:hover{
      color:var(--accent-2);
      text-decoration:underline;
    }
    
    /* ë°˜ì‘í˜• */
    @media(max-width:640px){
      .wrap{
        margin:40px auto;
      }
      .card{
        padding:28px 24px;
      }
      .headline{
        font-size:28px;
      }
    }
    
    /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
    @keyframes pulse{
      0%, 100%{opacity:1}
      50%{opacity:.5}
    }
    .loading{
      animation:pulse 1.5s ease-in-out infinite;
    }
  </style>
  <script>
    // ì´ë¯¸ ë¡œê·¸ì¸ ìƒíƒœë©´ íšŒì›ê°€ì… í˜ì´ì§€ ì ‘ê·¼ ì‹œ í™ˆìœ¼ë¡œ (íˆìŠ¤í† ë¦¬ ì¹˜í™˜)
    (function guardWhenLoggedIn(){
      const token = sessionStorage.getItem("access_token") || sessionStorage.getItem("token");
      if(token){ location.replace("/"); }
    })();

    // ë’¤ë¡œê°€ê¸°(bfcache)ë¡œ ë³µì›ë˜ì–´ë„ ì¬ê²€ì‚¬
    window.addEventListener("pageshow", (e)=>{
      const token = sessionStorage.getItem("access_token") || sessionStorage.getItem("token");
      if(token || e.persisted){ location.replace("/"); }
    });
  </script>
</head>
<body>
  <nav>
    <div class="left">ğŸ” Lockument</div>
    <div class="right">
      <a href="/">í™ˆ</a>
      <a href="/login">ë¡œê·¸ì¸</a>
    </div>
  </nav>

  <div class="wrap">
    <div class="card">
      <h1 class="headline">íšŒì›ê°€ì…</h1>
      <p class="sub">ì´ë©”ì¼ë¡œ ê°„ë‹¨íˆ ê°€ì…í•  ìˆ˜ ìˆì–´ìš”.</p>

      <form id="register-form" autocomplete="off">
        <label for="email">ğŸ“§ ì´ë©”ì¼</label>
        <input id="email" type="email" name="email" placeholder="you@example.com" required>

        <label for="username">ğŸ‘¤ ë‹‰ë„¤ì„ (ì„ íƒ)</label>
        <input id="username" type="text" name="username" placeholder="ì•„ë¦¬">

        <label for="password">ğŸ”‘ ë¹„ë°€ë²ˆí˜¸ (8ì ì´ìƒ)</label>
        <input id="password" type="password" name="password" minlength="8" placeholder="********" required>

        <button id="btnSubmit" type="submit" class="btn">íšŒì›ê°€ì…</button>
      </form>

      <div id="register-result"></div>
      
      <div class="meta">
        ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <a href="/login">ë¡œê·¸ì¸</a>
      </div>
    </div>
  </div>

  <script>
    const errors = {
      email_taken: "ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤.",
      invalid_email: "ì´ë©”ì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.",
      weak_password: "ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤."
    };

    const form = document.getElementById("register-form");
    const btn = document.getElementById("btnSubmit");
    const box = document.getElementById("register-result");

    form.addEventListener("submit", async (e)=>{
      e.preventDefault();
      
      // ê²°ê³¼ ë°•ìŠ¤ ì´ˆê¸°í™” ë° ë¡œë”© ìƒíƒœ
      box.className = "";
      box.style.display = "block";
      box.textContent = "ì²˜ë¦¬ ì¤‘...";
      box.classList.add("loading");
      btn.disabled = true;

      const data = {
        email: form.email.value.trim(),
        username: (form.username.value || "").trim(),
        password: form.password.value
      };

      try{
        const res = await fetch("/api/register", {
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body: JSON.stringify(data)
        });
        const json = await res.json().catch(()=>({ok:false, error:"invalid_json"}));

        box.classList.remove("loading");

        if(json.ok){
          // íšŒì›ê°€ì… ì„±ê³µ â†’ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ (ë’¤ë¡œê°€ê¸°ë¡œ ì´ í˜ì´ì§€ ì•ˆ ëŒì•„ì˜¤ë„ë¡ ì¹˜í™˜)
          box.className = "success";
          box.textContent = "âœ“ íšŒì›ê°€ì… ì„±ê³µ! ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤...";
          setTimeout(()=> location.replace("/login"), 1500);
        }else{
          box.className = "error";
          box.textContent = "âœ— " + (errors[json.error] || json.error || "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }catch(err){
        box.classList.remove("loading");
        box.className = "error";
        box.textContent = "âœ— ì—ëŸ¬: " + (err?.message || err);
      }finally{
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
