<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>ë¡œê·¸ì¸ - Lockument</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Cache-Control" content="no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <style>
    :root{
      --bg:#f8fafc; --text:#0f172a; --muted:#64748b;
      --card:#ffffff; --border:#e2e8f0;
      --accent:#3b82f6; --accent-hover:#2563eb;
      --ok:#10b981; --err:#ef4444;
      --radius:16px; --shadow:0 8px 24px rgba(0,0,0,.12);
      --gradient:linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Pretendard,"Apple SD Gothic Neo",sans-serif;
      background:var(--bg);
      color:var(--text);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
    }
    
    /* ë°°ê²½ ê·¸ë¼ë°ì´ì…˜ íš¨ê³¼ */
    body::before{
      content:"";
      position:fixed;
      top:0;
      left:0;
      right:0;
      bottom:0;
      background:var(--gradient);
      opacity:.05;
      z-index:0;
    }
    
    .card{
      position:relative;
      z-index:1;
      max-width:440px;
      width:100%;
      padding:40px;
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
    }
    
    .logo{
      text-align:center;
      font-size:36px;
      margin-bottom:8px;
    }
    
    h2{
      margin:0 0 10px;
      font-size:28px;
      font-weight:800;
      text-align:center;
      background:var(--gradient);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }
    
    p.sub{
      margin:0 0 28px;
      color:var(--muted);
      font-size:15px;
      text-align:center;
    }
    
    .input-group{
      margin-bottom:16px;
    }
    
    .input-group label{
      display:block;
      margin-bottom:6px;
      color:var(--text);
      font-weight:600;
      font-size:14px;
    }
    
    input{
      width:100%;
      padding:14px 16px;
      border-radius:10px;
      border:2px solid var(--border);
      background:#fff;
      color:var(--text);
      font-size:15px;
      transition:.2s;
      outline:none;
    }
    
    input:focus{
      border-color:var(--accent);
      box-shadow:0 0 0 3px rgba(59,130,246,.1);
    }
    
    input::placeholder{
      color:var(--muted);
    }
    
    button{
      margin-top:24px;
      width:100%;
      padding:14px;
      border:none;
      border-radius:10px;
      background:var(--gradient);
      color:#fff;
      font-weight:700;
      font-size:16px;
      cursor:pointer;
      transition:.2s;
      box-shadow:0 4px 12px rgba(102,126,234,.3);
    }
    
    button:hover{
      transform:translateY(-2px);
      box-shadow:0 6px 16px rgba(102,126,234,.4);
    }
    
    button:active{
      transform:translateY(0);
    }
    
    button:disabled{
      opacity:.6;
      cursor:not-allowed;
      transform:none;
    }
    
    .meta{
      margin-top:24px;
      text-align:center;
      font-size:14px;
      color:var(--muted);
    }
    
    .meta a{
      color:var(--accent);
      text-decoration:none;
      font-weight:700;
    }
    
    .meta a:hover{
      text-decoration:underline;
    }
    
    #login-result{
      margin-top:16px;
      padding:12px 16px;
      border-radius:8px;
      font-size:14px;
      font-weight:600;
      text-align:center;
      display:none;
    }
    
    #login-result.success{
      display:block;
      background:#d1fae5;
      color:#065f46;
      border:1px solid #6ee7b7;
    }
    
    #login-result.error{
      display:block;
      background:#fee2e2;
      color:#991b1b;
      border:1px solid #fecaca;
    }
    
    #login-result.loading{
      display:block;
      background:#dbeafe;
      color:#1e40af;
      border:1px solid #93c5fd;
    }
    
    /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
    @keyframes spin{
      to{transform:rotate(360deg)}
    }
    
    .spinner{
      display:inline-block;
      width:14px;
      height:14px;
      border:2px solid currentColor;
      border-right-color:transparent;
      border-radius:50%;
      animation:spin .6s linear infinite;
      margin-right:8px;
      vertical-align:middle;
    }
    
    /* ë°˜ì‘í˜• */
    @media(max-width:500px){
      .card{
        padding:32px 24px;
      }
      h2{font-size:24px}
      .logo{font-size:28px}
    }
  </style>
  <script>
    // âœ… ì„¸ì…˜ ìœ ì§€ ëŒ€ì‹  ë¸Œë¼ìš°ì € ë‹«ìœ¼ë©´ ìë™ ë¡œê·¸ì•„ì›ƒ(sessionStorage ì‚¬ìš©)
    (function guardWhenLoggedIn(){
      const token = sessionStorage.getItem("access_token") || sessionStorage.getItem("token");
      if(token){ location.replace("/"); }
    })();
    
    window.addEventListener("pageshow",(e)=>{
      const token = sessionStorage.getItem("access_token") || sessionStorage.getItem("token");
      if(token){ location.replace("/"); }
    });
    
    document.addEventListener("DOMContentLoaded", ()=>{
      const loginBtn = document.getElementById("login-btn");
      const emailInput = document.getElementById("email");
      const passwordInput = document.getElementById("password");
      const resultBox = document.getElementById("login-result");
      
      // Enter í‚¤ ì²˜ë¦¬
      [emailInput, passwordInput].forEach(input => {
        input.addEventListener("keypress", (e) => {
          if(e.key === "Enter"){
            loginBtn.click();
          }
        });
      });
      
      loginBtn.addEventListener("click", async ()=>{
        const email = emailInput.value.trim();
        const password = passwordInput.value;
        
        // ìœ íš¨ì„± ê²€ì‚¬
        if(!email){
          resultBox.className = "error";
          resultBox.textContent = "âŒ ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
          emailInput.focus();
          return;
        }
        
        if(!password){
          resultBox.className = "error";
          resultBox.textContent = "âŒ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.";
          passwordInput.focus();
          return;
        }
        
        // ë¡œë”© ìƒíƒœ
        resultBox.className = "loading";
        resultBox.innerHTML = '<span class="spinner"></span>ë¡œê·¸ì¸ ì¤‘...';
        loginBtn.disabled = true;
        
        try {
          const res = await fetch("/api/login", {
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body: JSON.stringify({ email, password })
          });
          
          const json = await res.json();
          
          if(json.ok){
            // âœ… sessionStorageì— ë¡œê·¸ì¸ ì„¸ì…˜ ì €ì¥ (ë¸Œë¼ìš°ì € ë‹«ìœ¼ë©´ ì‚¬ë¼ì§)
            sessionStorage.setItem("access_token", json.access_token);
            sessionStorage.setItem("token", json.access_token); // í˜¸í™˜ì„±
            sessionStorage.setItem("user_role", json.user.role || "user");
            sessionStorage.setItem("role", json.user.role || "user"); // í˜¸í™˜ì„±
            
            if(json.expires_in){
              const expiry = Math.floor(Date.now()/1000) + json.expires_in;
              sessionStorage.setItem("token_expiry", expiry);
            }
            
            resultBox.className = "success";
            resultBox.textContent = "âœ… ë¡œê·¸ì¸ ì„±ê³µ! ì´ë™ ì¤‘...";
            
            // ë¶€ë“œëŸ¬ìš´ ì „í™˜ì„ ìœ„í•œ ë”œë ˆì´
            setTimeout(() => {
              location.replace("/");
            }, 800);
            
          }else{
            resultBox.className = "error";
            resultBox.textContent = "âŒ " + (json.message || json.error || "ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            loginBtn.disabled = false;
          }
          
        }catch(err){
          console.error("Login error:", err);
          resultBox.className = "error";
          resultBox.textContent = "âŒ ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
          loginBtn.disabled = false;
        }
      });
    });
  </script>
</head>
<body>
  <div class="card">
    <div class="logo">ğŸ”</div>
    <h2>Lockument</h2>
    <p class="sub">ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”</p>
    
    <form id="login-form" onsubmit="return false;">
      <div class="input-group">
        <label for="email">ì´ë©”ì¼</label>
        <input type="email" id="email" placeholder="example@email.com" required autocomplete="email">
      </div>
      
      <div class="input-group">
        <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
        <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required autocomplete="current-password">
      </div>
      
      <button type="button" id="login-btn">ë¡œê·¸ì¸</button>
    </form>
    
    <div id="login-result"></div>
    
    <div class="meta">
      ì²˜ìŒì´ì‹ ê°€ìš”? <a href="/register">íšŒì›ê°€ì…</a>
    </div>
  </div>
</body>
</html>
